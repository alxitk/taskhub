{% extends 'base.html' %}

{% block title %}
  <title>{{ task.name }} | TaskHub</title>
{% endblock %}

{% block content %}
<div class="container py-4">
  <div class="mb-4">
    <h1 class="mb-2 font-weight-bold">{{ task.name }}</h1>
    <span class="badge badge-pill badge-info px-3 py-2">{{ task.status }}</span>
  </div>

  <div class="card p-4 shadow rounded-4 bg-light mb-4">
    <h5 class="mb-3 text-secondary">ğŸ“ Description</h5>
    <p class="mb-0 text-muted">{{ task.description|linebreaks }}</p>
  </div>

  <div class="d-flex gap-2 mb-3">

    {% if user in task.assignees.all %}
      <form method="post" action="" class="mr-2">
        {% csrf_token %}
        <button type="submit" class="reg-btn bg-danger text-white w-100">
          <i class="bx bx-user-x"></i> Unassign Me
        </button>
      </form>
    {% else %}
      <form method="post" action="{% url 'tasks:assign-me' task.id %}" class="mr-2">
        {% csrf_token %}
        <button type="submit" class="reg-btn bg-success text-white w-100">
          <i class="bx bx-user-plus"></i> Assign Me
        </button>
      </form>
    {% endif %}


    <a href="" class="reg-btn w-100 text-center">
      <i class="bx bx-user-plus"></i> Assign User
    </a>

    <a href="" class="reg-btn w-100 text-center bg-warning text-dark">
      <i class="bx bx-user-x"></i> Unassign User
    </a>
  </div>

  <div class="d-flex gap-2">
    <a href="{% url 'tasks:task-update' pk=task.id %}" class="reg-btn w-50 text-center">
      <i class="bx bx-edit-alt mr-1"></i> Update
    </a>
    <a href="{% url 'tasks:task-delete' pk=task.id %}" class="reg-btn w-50 text-center bg-danger text-white">
      <i class="bx bx-trash mr-1"></i> Delete
    </a>
  </div>
</div>
{% endblock %}

{% block sidebar %}
  <div class="card shadow-sm rounded-4 p-4 mb-4 bg-light">
    <h5 class="mb-3 text-secondary">ğŸ“‹ Task Details</h5>
    <p class="mb-2"><strong>Type:</strong> {{ task.task_type }}</p>
    <p class="mb-2"><strong>Priority:</strong> {{ task.priority }}</p>
    <p class="mb-0"><strong>Deadline:</strong> {{ task.deadline }}</p>
  </div>

  <div class="card shadow-sm rounded-4 p-4 mb-4 bg-light">
    <h5 class="mb-3 text-secondary">ğŸ‘¥ Assignees</h5>
    <ul class="pl-3 mb-0">
      {% for assignee in task.assignees.all %}
        <li class="mb-1">
          <a href="{% url 'tasks:worker-detail' assignee.id %}" class="text-decoration-none text-dark">
            <i class="fas fa-user-circle mr-1 text-info"></i>
            {{ assignee.username }} ({{ assignee.first_name }} {{ assignee.last_name }})
          </a>
        </li>
      {% empty %}
        <li class="text-muted">No assignees</li>
      {% endfor %}
    </ul>
  </div>
{% endblock %}