{% extends 'base.html' %}

{% block title %}
  <title>{{ task.name }} | TaskHub</title>
{% endblock %}

{% block content %}
<div class="container py-4">
  <div class="mb-4 text-center">
    <h1 class="mb-2 font-weight-bold">{{ task.name }}</h1>
    <span class="badge badge-pill badge-info px-3 py-2">{{ task.status }}</span>
    <div class="d-flex justify-content-center my-4">
      <button type="button" class="reg-btn" data-bs-toggle="modal" data-bs-target="#statusModal{{ task.id }}">
        Change Status
      </button>
    </div>
{#    ÐœÐ¾Ð´Ð°Ð»ÑŒÐ½Ð¾Ðµ Ð¾ÐºÐ½Ð¾ Ð¾Ñ‚ chatGPT#}
    <div class="modal fade" id="statusModal{{ task.id }}" tabindex="-1" aria-labelledby="statusModalLabel{{ task.id }}" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content shadow rounded-4 border-0">
          <div class="modal-header bg-gradient text-white rounded-top-4" style="background-image: linear-gradient(180deg, #fe675c, #fd267d);">
            <h5 class="modal-title" id="statusModalLabel{{ task.id }}">Change Task Status</h5>
            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>

          <div class="modal-body">
            <form method="post" action="{% url 'tasks:set-status' pk=task.id %}">
              {% csrf_token %}
              <div class="mb-3">
              <label for="statusSelect{{ task.id }}" class="form-label">Select new status:</label>
                <select id="statusSelect{{ task.id }}" name="status" class="form-select">
                  <option value="todo" {% if task.status == "todo" %}selected{% endif %}>To Do</option>
                  <option value="in_progress" {% if task.status == "in_progress" %}selected{% endif %}>In Progress</option>
                  <option value="needs_review" {% if task.status == "needs_review" %}selected{% endif %}>Needs Review</option>
                  <option value="done" {% if task.status == "done" %}selected{% endif %}>Done</option>
                </select>
              </div>
            <div class="d-flex justify-content-end gap-2">
              <button type="button" class="reg-btn-secondary" data-bs-dismiss="modal">Cancel</button>
              <button type="submit" class="reg-btn">Save</button>
            </div>
        </form>
      </div>

    </div>
  </div>
</div>

  <div class="card p-4 shadow rounded-4 bg-light mb-4">
    <h5 class="mb-3 text-secondary">Description</h5>
    <p class="mb-0 text-muted">{{ task.description|linebreaks }}</p>
  </div>

  <div class="d-flex gap-2 justify-content-center">
    <a href="{% url 'tasks:task-update' pk=task.id %}" class="reg-btn w-50 text-center">
      <i class="bx bx-edit-alt mr-1"></i> Update
    </a>
    <a href="{% url 'tasks:task-delete' pk=task.id %}" class="reg-btn w-50 text-center bg-danger text-white">
      <i class="bx bx-trash mr-1"></i> Delete
    </a>
  </div>
</div>
{% endblock %}

{% block sidebar %}
  <div class="card shadow-sm rounded-4 p-4 mb-4 bg-light">
    <h5 class="mb-3 text-secondary">ðŸ“‹ Task Details</h5>
    <p class="mb-2"><strong>Type:</strong> {{ task.task_type }}</p>
    <p class="mb-2"><strong>Priority:</strong> {{ task.priority }}</p>
    <p class="mb-0"><strong>Deadline:</strong> {{ task.deadline }}</p>
  </div>

  <div class="card shadow-sm rounded-4 p-4 mb-4 bg-light">
    <h5 class="mb-3 text-secondary">ðŸ‘¥ Assignees</h5>
    <ul class="pl-3 mb-3">
      {% for assignee in task.assignees.all %}
        <li class="mb-1">
          <a href="{% url 'tasks:worker-detail' assignee.id %}" class="text-decoration-none text-dark">
            <i class="fas fa-user-circle mr-1 text-info"></i>
            {{ assignee.username }} ({{ assignee.first_name }} {{ assignee.last_name }})
          </a>
        </li>
      {% empty %}
        <li class="text-muted">No assignees</li>
      {% endfor %}
    </ul>

    <form method="post" action="{% url 'tasks:toggle-task-assign' task.id %}" class="mb-2">
      {% csrf_token %}
      <button type="submit"
        class="reg-btn w-100 d-flex justify-content-center align-items-center gap-2
        {% if user in task.assignees.all %} bg-danger text-white {% else %} bg-success text-white {% endif %}">
        {% if user in task.assignees.all %}
          <i class="bx bx-user-x"></i> Unassign Me
        {% else %}
          <i class="bx bx-user-plus"></i> Assign Me
        {% endif %}
      </button>
    </form>

    <a href="" class="reg-btn w-100 text-center mb-2">
      <i class="bx bx-user-plus"></i> Assign User
    </a>

    <a href="" class="reg-btn w-100 text-center bg-warning text-dark">
      <i class="bx bx-user-x"></i> Unassign User
    </a>
  </div>
{% endblock %}